# Backend development Docker image (with hot-reload)
FROM oven/bun:1

WORKDIR /app

# Copy workspace configuration and lock file
COPY package.json bun.lockb* ./

# Copy backend package files
COPY apps/backend/package.json ./apps/backend/
COPY apps/backend/tsconfig.json ./apps/backend/
COPY packages/shared/package.json ./packages/shared/
COPY packages/shared/tsconfig.json ./packages/shared/

# Install dependencies
RUN bun install --frozen-lockfile

# Expose port
EXPOSE 3000

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD curl -f http://localhost:3000/api/health || exit 1

# Run the backend with watch mode (source code will be mounted via volumes)
CMD ["bun", "--watch", "apps/backend/src/index.ts"]
